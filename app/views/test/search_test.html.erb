<!DOCTYPE html>
<html>
<head>
  <title>Teste de Busca</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
    <h1>Teste de Busca Avançada</h1>

    <!-- Busca Simples -->
    <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
      <h2>Busca Simples</h2>

      <%= form_with url: test_search_test_path, method: :get, local: true do |f| %>
        <div style="display: flex; gap: 10px;">
          <%= f.text_field :query,
                          value: @query,
                          placeholder: "Digite para buscar profissionais...",
                          style: "flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px;" %>
          <%= f.submit "Buscar", style: "padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;" %>
        </div>
      <% end %>
    </div>

    <!-- Resultados -->
    <% if @query.present? %>
      <div style="background: #f5f5f5; padding: 20px; border-radius: 8px;">
        <h2>Resultados para: "<%= @query %>"</h2>

        <% if @error %>
          <div style="color: red; background: #ffe6e6; border: 1px solid #ff9999; padding: 10px; border-radius: 4px;">
            <strong>Erro:</strong> <%= @error %>
          </div>
        <% elsif @results.any? %>
          <div style="color: green; margin-bottom: 10px;">
            Encontrados <%= @results.length %> resultados
          </div>

          <div style="space-y: 10px;">
            <% @results.each do |result| %>
              <div style="border: 1px solid #ddd; padding: 15px; border-radius: 4px; background: white;">
                <h3 style="margin: 0 0 5px 0;"><%= result.full_name %></h3>
                <p style="margin: 0; color: #666;"><%= result.email %></p>
                <p style="margin: 5px 0 0 0; font-size: 12px; color: #999;">ID: <%= result.id %></p>
              </div>
            <% end %>
          </div>
        <% else %>
          <div style="color: #666;">
            Nenhum resultado encontrado.
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Debug Info -->
    <div style="background: #e9ecef; padding: 15px; border-radius: 8px; margin-top: 20px;">
      <h3>Informações de Debug:</h3>
      <ul style="margin: 0; padding-left: 20px;">
        <li><strong>Query:</strong> <%= @query || "Nenhuma" %></li>
        <li><strong>Resultados:</strong> <%= @results&.length || 0 %></li>
        <li><strong>Erro:</strong> <%= @error || "Nenhum" %></li>
        <li><strong>MeiliSearch Status:</strong>
          <% begin %>
            <% require 'net/http' %>
            <% response = Net::HTTP.get_response(URI('http://localhost:7700/health')) %>
            <%= response.code == '200' ? 'Online' : 'Erro: ' + response.code %>
          <% rescue %>
            Offline
          <% end %>
        </li>
      </ul>
    </div>
  </div>
</body>
</html>
