<div class="page-header d-print-none">
  <div class="container-xl">
    <div class="row g-2 align-items-center">
      <div class="col">
        <h2 class="page-title">
          Usu√°rio: <%= @user.name %>
        </h2>
      </div>
      <div class="col-auto ms-auto d-print-none">
        <div class="btn-list">
          <%= link_to 'Editar', edit_admin_user_path(@user), class: 'btn btn-primary' %>
          <%= link_to 'Voltar', admin_users_path, class: 'btn btn-outline-secondary' %>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="page-body">
  <div class="container-xl">
    <div class="row row-cards">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Informa√ß√µes do Usu√°rio</h3>
          </div>
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-auto">
                <span class="avatar avatar-lg">
                  <% if @user.avatar.attached? %>
                    <%= image_tag @user.avatar, class: 'avatar' %>
                  <% else %>
                    <span class="avatar-initials"><%= @user.name.first.upcase %></span>
                  <% end %>
                </span>
              </div>
              <div class="col">
                <h3 class="mb-1"><%= @user.name %></h3>
                <div class="text-muted"><%= @user.email %></div>
                <div class="mt-2">
                  <% if @user.professional&.active? %>
                    <span class="badge bg-success">‚úÖ Ativo</span>
                  <% elsif @user.pending_invite? %>
                    <span class="badge bg-warning">‚è≥ Pendente</span>
                  <% elsif @user.professional&.active? == false %>
                    <span class="badge bg-danger">‚ùå Inativo</span>
                  <% elsif @user.latest_invite&.expired? %>
                    <span class="badge bg-secondary">üîÑ Expirado</span>
                  <% else %>
                    <span class="badge bg-secondary">Sem usu√°rio</span>
                  <% end %>
                </div>
              </div>
            </div>
            
            <div class="mt-4">
              <div class="row">
                <div class="col-6">
                  <div class="text-muted">Criado em</div>
                  <div><%= l(@user.created_at, format: :long) %></div>
                </div>
                <div class="col-6">
                  <div class="text-muted">√öltimo acesso</div>
                  <div><%= @user.last_sign_in_at ? l(@user.last_sign_in_at, format: :long) : 'Nunca' %></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Profissional Associado</h3>
          </div>
          <div class="card-body">
            <% if @user.professional %>
              <div class="row align-items-center">
                <div class="col">
                  <h4 class="mb-1"><%= @user.professional.full_name %></h4>
                  <div class="text-muted"><%= @user.professional.email %></div>
                  <div class="mt-2">
                    <% @user.professional.specialities.each do |speciality| %>
                      <span class="badge bg-blue"><%= speciality.name %></span>
                    <% end %>
                  </div>
                </div>
                <div class="col-auto">
                  <%= link_to 'Ver Profissional', admin_professional_path(@user.professional), class: 'btn btn-sm btn-outline-primary' %>
                </div>
              </div>
              
              <div class="mt-3">
                <div class="row">
                  <div class="col-6">
                    <div class="text-muted">Status</div>
                    <div>
                      <% if @user.professional.active? %>
                        <span class="badge bg-success">Ativo</span>
                      <% else %>
                        <span class="badge bg-danger">Inativo</span>
                      <% end %>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="text-muted">Grupos</div>
                    <div>
                      <% @user.professional.groups.each do |group| %>
                        <span class="badge bg-secondary"><%= group.name %></span>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% else %>
              <div class="text-center text-muted">
                <p>Nenhum profissional associado</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row mt-3">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Hist√≥rico de Convites</h3>
          </div>
          <div class="card-body">
            <% if @invites.any? %>
              <div class="table-responsive">
                <table class="table table-vcenter">
                  <thead>
                    <tr>
                      <th>Token</th>
                      <th>Status</th>
                      <th>Criado em</th>
                      <th>Expira em</th>
                      <th>Confirmado em</th>
                      <th>Tentativas</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @invites.each do |invite| %>
                      <tr>
                        <td><code><%= invite.token %></code></td>
                        <td>
                          <% if invite.confirmed? %>
                            <span class="badge bg-success">Confirmado</span>
                          <% elsif invite.expired? %>
                            <span class="badge bg-danger">Expirado</span>
                          <% else %>
                            <span class="badge bg-warning">Pendente</span>
                          <% end %>
                        </td>
                        <td><%= l(invite.created_at, format: :short) %></td>
                        <td><%= l(invite.expires_at, format: :short) %></td>
                        <td><%= invite.confirmed_at ? l(invite.confirmed_at, format: :short) : '-' %></td>
                        <td><%= invite.attempts_count %></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            <% else %>
              <div class="text-center text-muted">
                <p>Nenhum convite encontrado</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
