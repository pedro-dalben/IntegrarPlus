<%= render ::Layouts::AdminComponent.new do |c| %>
  <% c.with_actions do %>
    <%= link_to admin_user_path(@user), class: "ta-btn ta-btn-secondary inline-flex items-center gap-2" do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      <%= t('admin.invites.buttons.back') %>
    <% end %>

    <%= link_to admin_user_invites_path(@user),
        method: :post,
        class: "ta-btn ta-btn-success inline-flex items-center gap-2",
        data: {
          turbo_method: :post,
          confirm: "Gerar novo convite para #{@user.email}?"
        } do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"/>
      </svg>
      <%= t('admin.invites.buttons.new_invite') %>
    <% end %>
  <% end %>

  <div class="space-y-6">
    <!-- Informações do Usuário -->
    <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
      <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-800">
        <h2 class="text-lg font-medium text-gray-800 dark:text-white"><%= t('admin.invites.sections.user_invites', email: @user.email) %></h2>
      </div>
      <div class="p-4 sm:p-6">
        <% if @invites.any? %>
          <div class="overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
              <thead class="bg-gray-50 dark:bg-gray-800">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Token</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Criado em</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Expira em</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Confirmado em</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Tentativas</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                </tr>
              </thead>
              <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
                <% @invites.each do |invite| %>
                  <tr class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900 dark:text-white">
                      <%= invite.token %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <% if invite.confirmed? %>
                        <span class="ta-badge ta-badge-success">Confirmado</span>
                      <% elsif invite.expired? %>
                        <span class="ta-badge ta-badge-error">Expirado</span>
                      <% else %>
                        <span class="ta-badge ta-badge-warning">Pendente</span>
                      <% end %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                      <%= l(invite.created_at, format: :short) %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                      <%= l(invite.expires_at, format: :short) %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                      <%= invite.confirmed_at ? l(invite.confirmed_at, format: :short) : '-' %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                      <%= invite.attempts_count %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                      <div class="flex items-center justify-end gap-2">
                        <% if invite.expired? %>
                          <%= link_to resend_admin_invite_path(invite),
                              method: :patch,
                              class: "ta-btn ta-btn-sm ta-btn-secondary inline-flex items-center gap-1",
                              data: { confirm: "Renovar este convite expirado?" } do %>
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Renovar
                          <% end %>
                        <% end %>

                        <%= link_to admin_invite_path(invite),
                            method: :delete,
                            class: "ta-btn ta-btn-sm ta-btn-secondary inline-flex items-center gap-1 border-red-300 text-red-700 hover:bg-red-50 dark:border-red-600 dark:text-red-400 dark:hover:bg-red-900/10",
                            data: { confirm: "Excluir este convite?" } do %>
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                          </svg>
                          Excluir
                        <% end %>
                      </div>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <div class="text-center py-8">
            <p class="text-gray-500 dark:text-gray-400">Nenhum convite encontrado para este usuário</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
