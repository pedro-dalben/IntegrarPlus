<% content_for :title, "Anamnese - #{@anamnesis.beneficiary_name}" %>

<div class="ta-content-wrapper">
  <div class="ta-content-header">
    <div class="ta-content-header-left">
      <h1 class="ta-content-title">Anamnese</h1>
      <p class="ta-content-subtitle"><%= @anamnesis.beneficiary_name %></p>
    </div>
    <div class="ta-content-header-right">
      <%= link_to admin_anamneses_path, class: "ta-btn ta-btn-secondary" do %>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Voltar
      <% end %>
      
      <% if @anamnesis.pode_ser_editada? && current_user.permit?('anamneses.edit') %>
        <%= link_to edit_admin_anamnesis_path(@anamnesis), class: "ta-btn ta-btn-primary" do %>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
          </svg>
          Editar
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Informações Gerais -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-6">
      <!-- Dados do Beneficiário -->
      <div class="ta-card">
        <div class="ta-card-header">
          <h3 class="ta-card-title">Dados do Beneficiário</h3>
        </div>
        <div class="ta-card-body">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="ta-form-label">Nome</label>
              <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.beneficiary.name %></p>
            </div>
            <div>
              <label class="ta-form-label">Data de Nascimento</label>
              <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.beneficiary.birth_date.strftime("%d/%m/%Y") %></p>
            </div>
            <div>
              <label class="ta-form-label">Idade</label>
              <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.beneficiary.age %> anos</p>
            </div>
            <div>
              <label class="ta-form-label">CPF</label>
              <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.beneficiary.cpf %></p>
            </div>
            <div>
              <label class="ta-form-label">Código Integrar</label>
              <p class="text-gray-900 dark:text-gray-100 font-mono"><%= @anamnesis.beneficiary.integrar_code %></p>
            </div>
            <div>
              <label class="ta-form-label">Status</label>
              <span class="<%= @anamnesis.beneficiary.status_badge_class %>">
                <%= @anamnesis.beneficiary.status_label %>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Dados da Família -->
      <div class="ta-card">
        <div class="ta-card-header">
          <h3 class="ta-card-title">Dados da Família</h3>
        </div>
        <div class="ta-card-body">
          <div class="space-y-6">
            <!-- Pai -->
            <% if @anamnesis.father_name.present? %>
              <div>
                <h4 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3">Pai</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="ta-form-label">Nome</label>
                    <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.father_name %></p>
                  </div>
                  <% if @anamnesis.father_birth_date.present? %>
                    <div>
                      <label class="ta-form-label">Data de Nascimento</label>
                      <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.father_birth_date.strftime("%d/%m/%Y") %></p>
                    </div>
                  <% end %>
                  <% if @anamnesis.father_education.present? %>
                    <div>
                      <label class="ta-form-label">Escolaridade</label>
                      <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.father_education %></p>
                    </div>
                  <% end %>
                  <% if @anamnesis.father_profession.present? %>
                    <div>
                      <label class="ta-form-label">Profissão</label>
                      <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.father_profession %></p>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>

            <!-- Mãe -->
            <% if @anamnesis.mother_name.present? %>
              <div>
                <h4 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3">Mãe</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="ta-form-label">Nome</label>
                    <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.mother_name %></p>
                  </div>
                  <% if @anamnesis.mother_birth_date.present? %>
                    <div>
                      <label class="ta-form-label">Data de Nascimento</label>
                      <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.mother_birth_date.strftime("%d/%m/%Y") %></p>
                    </div>
                  <% end %>
                  <% if @anamnesis.mother_education.present? %>
                    <div>
                      <label class="ta-form-label">Escolaridade</label>
                      <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.mother_education %></p>
                    </div>
                  <% end %>
                  <% if @anamnesis.mother_profession.present? %>
                    <div>
                      <label class="ta-form-label">Profissão</label>
                      <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.mother_profession %></p>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>

            <!-- Responsável -->
            <% if @anamnesis.responsible_name.present? %>
              <div>
                <h4 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3">Responsável</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="ta-form-label">Nome</label>
                    <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.responsible_name %></p>
                  </div>
                  <% if @anamnesis.responsible_birth_date.present? %>
                    <div>
                      <label class="ta-form-label">Data de Nascimento</label>
                      <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.responsible_birth_date.strftime("%d/%m/%Y") %></p>
                    </div>
                  <% end %>
                  <% if @anamnesis.responsible_education.present? %>
                    <div>
                      <label class="ta-form-label">Escolaridade</label>
                      <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.responsible_education %></p>
                    </div>
                  <% end %>
                  <% if @anamnesis.responsible_profession.present? %>
                    <div>
                      <label class="ta-form-label">Profissão</label>
                      <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.responsible_profession %></p>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Dados Escolares -->
      <% if @anamnesis.attends_school? %>
        <div class="ta-card">
          <div class="ta-card-header">
            <h3 class="ta-card-title">Dados Escolares</h3>
          </div>
          <div class="ta-card-body">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="ta-form-label">Frequenta Escola</label>
                <p class="text-gray-900 dark:text-gray-100">Sim</p>
              </div>
              <% if @anamnesis.school_name.present? %>
                <div>
                  <label class="ta-form-label">Nome da Escola</label>
                  <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.school_name %></p>
                </div>
              <% end %>
              <% if @anamnesis.school_period.present? %>
                <div>
                  <label class="ta-form-label">Período</label>
                  <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.school_period.humanize %></p>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Motivo do Encaminhamento -->
      <div class="ta-card">
        <div class="ta-card-header">
          <h3 class="ta-card-title">Motivo do Encaminhamento</h3>
        </div>
        <div class="ta-card-body">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="ta-form-label">Motivo</label>
              <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.referral_reason_label %></p>
            </div>
            <div>
              <label class="ta-form-label">Liminar</label>
              <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.injunction? ? "Sim" : "Não" %></p>
            </div>
            <div>
              <label class="ta-form-label">Local do Atendimento</label>
              <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.treatment_location_label %></p>
            </div>
            <div>
              <label class="ta-form-label">Horas do Pacote</label>
              <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.referral_hours %> horas</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Status e Informações -->
      <div class="ta-card">
        <div class="ta-card-header">
          <h3 class="ta-card-title">Informações</h3>
        </div>
        <div class="ta-card-body">
          <div class="space-y-4">
            <div>
              <label class="ta-form-label">Status</label>
              <span class="<%= @anamnesis.status_badge_class %>">
                <%= @anamnesis.status_label %>
              </span>
            </div>
            
            <div>
              <label class="ta-form-label">Data Realizada</label>
              <p class="text-gray-900 dark:text-gray-100">
                <%= @anamnesis.performed_at.strftime("%d/%m/%Y às %H:%M") %>
              </p>
            </div>
            
            <div>
              <label class="ta-form-label">Profissional</label>
              <p class="text-gray-900 dark:text-gray-100"><%= @anamnesis.professional_name %></p>
            </div>
            
            <div>
              <label class="ta-form-label">Criada em</label>
              <p class="text-gray-900 dark:text-gray-100">
                <%= @anamnesis.created_at.strftime("%d/%m/%Y às %H:%M") %>
              </p>
            </div>
            
            <% if @anamnesis.updated_at != @anamnesis.created_at %>
              <div>
                <label class="ta-form-label">Atualizada em</label>
                <p class="text-gray-900 dark:text-gray-100">
                  <%= @anamnesis.updated_at.strftime("%d/%m/%Y às %H:%M") %>
                </p>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Ações -->
      <div class="ta-card">
        <div class="ta-card-header">
          <h3 class="ta-card-title">Ações</h3>
        </div>
        <div class="ta-card-body">
          <div class="space-y-3">
            <% if @anamnesis.pode_ser_editada? && current_user.permit?('anamneses.edit') %>
              <%= link_to edit_admin_anamnesis_path(@anamnesis), class: "ta-btn ta-btn-primary w-full" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                Editar Anamnese
              <% end %>
            <% end %>

            <% if @anamnesis.pode_ser_concluida? && current_user.permit?('anamneses.complete') %>
              <%= link_to complete_admin_anamnesis_path(@anamnesis), 
                  method: :patch,
                  class: "ta-btn ta-btn-success w-full", 
                  data: { 
                    confirm: "Tem certeza que deseja concluir esta anamnese?",
                    turbo_method: :patch
                  } do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Concluir Anamnese
              <% end %>
            <% end %>

            <%= link_to admin_beneficiary_path(@anamnesis.beneficiary), class: "ta-btn ta-btn-secondary w-full" do %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              Ver Beneficiário
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
