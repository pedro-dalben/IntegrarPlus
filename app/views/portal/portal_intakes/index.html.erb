<% content_for(:title, "Minhas Solicitações - Portal de Operadoras") %>

<div class="space-y-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
        Minhas Solicitações
      </h1>
      <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
        Acompanhe o status das suas solicitações de entrada de beneficiários
      </p>
    </div>
    <div class="mt-4 sm:mt-0">
      <%= link_to new_portal_portal_intake_path,
                  class: "ta-btn ta-btn-primary" do %>
        <svg class="size-4 me-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        Nova Solicitação
      <% end %>
    </div>
  </div>

  <!-- Filtros -->
  <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6 mb-6">
    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Filtros</h3>

    <%= form_with url: request.path, method: :get, local: true, class: "space-y-4" do |form| %>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Status -->
        <div>
          <%= form.label :status, "Status", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
          <%= form.select :status,
                         options_for_select([['Todos', '']] + @statuses.map { |s| [s.humanize, s] }, params[:status]),
                         {},
                         { class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" } %>
        </div>

        <!-- Data início -->
        <div>
          <%= form.label :start_date, "Data início", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
          <%= form.date_field :start_date,
                             value: params[:start_date],
                             class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" %>
        </div>

        <!-- Data fim -->
        <div>
          <%= form.label :end_date, "Data fim", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
          <%= form.date_field :end_date,
                             value: params[:end_date],
                             class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" %>
        </div>
      </div>

      <div class="flex space-x-3">
        <%= form.submit "Filtrar", class: "ta-btn ta-btn-primary" %>
        <%= link_to "Limpar", request.path, class: "ta-btn ta-btn-secondary" %>
      </div>
    <% end %>
  </div>

  <!-- Tabela -->
  <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
      <h3 class="text-lg font-medium text-gray-900 dark:text-white">
        Solicitações
      </h3>
    </div>

    <% if @portal_intakes.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-800">
          <thead class="bg-gray-50 dark:bg-gray-800/50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Data de Entrada
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Beneficiário
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Plano / Carteirinha
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Status
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Data Agendada
              </th>
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Ações
              </th>
            </tr>
          </thead>
          <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800">
            <% @portal_intakes.each do |portal_intake| %>
              <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
                  <%= portal_intake.requested_at.strftime('%d/%m/%Y às %H:%M') %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900 dark:text-gray-100">
                    <%= portal_intake.nome %>
                  </div>
                  <% if portal_intake.cpf.present? %>
                    <div class="text-xs text-gray-500 dark:text-gray-400">
                      CPF: <%= portal_intake.cpf %>
                    </div>
                  <% end %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900 dark:text-gray-100">
                    <%= portal_intake.convenio %>
                  </div>
                  <div class="text-sm text-gray-500 dark:text-gray-400">
                    <%= portal_intake.card_code %>
                  </div>
                  <% if portal_intake.portal_intake_referrals.any? %>
                    <div class="text-xs text-blue-600 dark:text-blue-400">
                      <%= pluralize(portal_intake.portal_intake_referrals.count, 'encaminhamento') %>
                    </div>
                  <% end %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="<%= portal_intake.status_badge_class %>">
                    <%= portal_intake.status_label %>
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
                  <%= portal_intake.anamnesis_scheduled_on&.strftime('%d/%m/%Y') || '-' %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <%= link_to "Ver", portal_portal_intake_path(portal_intake),
                              class: "text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <!-- Paginação -->
      <% if @pagy %>
        <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-800">
          <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
        </div>
      <% end %>
    <% else %>
      <div class="px-6 py-12 text-center">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <h3 class="mt-4 text-sm font-medium text-gray-900 dark:text-gray-100">
          Nenhuma solicitação encontrada
        </h3>
        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
          Comece criando sua primeira solicitação de entrada.
        </p>
        <div class="mt-6">
          <%= link_to new_portal_portal_intake_path,
                      class: "ta-btn ta-btn-primary" do %>
            <svg class="size-4 me-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Nova Solicitação
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
