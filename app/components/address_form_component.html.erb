<% address_form do |af| %>
  <div data-controller="cep" class="space-y-4">
    <!-- CEP -->
    <div>
      <%= af.label :zip_code, "CEP", class: label_classes %>
      <%= af.text_field :zip_code,
          placeholder: "00000-000",
          maxlength: 9,
          data: {
            cep_target: "zipCode",
            action: "input->cep#formatZipCode blur->cep#search"
          },
          class: "#{input_classes} #{required_class}" %>

      <!-- Indicador de carregamento -->
      <div data-cep-target="loading" style="display: none;" class="text-sm text-gray-500 mt-1">
        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-blue-600 inline" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Buscando CEP...
      </div>
    </div>

    <!-- Grid para campos de endereço -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Rua -->
      <div class="md:col-span-2">
        <%= af.label :street, "Rua", class: label_classes %>
        <%= af.text_field :street,
            placeholder: "Nome da rua",
            data: { cep_target: "street" },
            class: "#{input_classes} #{required_class}" %>
      </div>

      <!-- Número -->
      <div>
        <%= af.label :number, "Número", class: label_classes %>
        <%= af.text_field :number,
            placeholder: "Número",
            class: input_classes %>
      </div>

      <!-- Complemento -->
      <div>
        <%= af.label :complement, "Complemento", class: label_classes %>
        <%= af.text_field :complement,
            placeholder: "Apto, Sala, etc.",
            class: input_classes %>
      </div>

      <!-- Bairro -->
      <div>
        <%= af.label :neighborhood, "Bairro", class: label_classes %>
        <%= af.text_field :neighborhood,
            placeholder: "Nome do bairro",
            data: { cep_target: "neighborhood" },
            class: "#{input_classes} #{required_class}" %>
      </div>

      <!-- Cidade -->
      <div>
        <%= af.label :city, "Cidade", class: label_classes %>
        <%= af.text_field :city,
            placeholder: "Nome da cidade",
            data: { cep_target: "city" },
            class: "#{input_classes} #{required_class}" %>
      </div>

      <!-- Estado -->
      <div>
        <%= af.label :state, "Estado", class: label_classes %>
        <%= af.select :state,
            options_for_select([
              ['Selecione...', ''],
              ['Acre', 'AC'], ['Alagoas', 'AL'], ['Amapá', 'AP'], ['Amazonas', 'AM'],
              ['Bahia', 'BA'], ['Ceará', 'CE'], ['Distrito Federal', 'DF'], ['Espírito Santo', 'ES'],
              ['Goiás', 'GO'], ['Maranhão', 'MA'], ['Mato Grosso', 'MT'], ['Mato Grosso do Sul', 'MS'],
              ['Minas Gerais', 'MG'], ['Pará', 'PA'], ['Paraíba', 'PB'], ['Paraná', 'PR'],
              ['Pernambuco', 'PE'], ['Piauí', 'PI'], ['Rio de Janeiro', 'RJ'], ['Rio Grande do Norte', 'RN'],
              ['Rio Grande do Sul', 'RS'], ['Rondônia', 'RO'], ['Roraima', 'RR'], ['Santa Catarina', 'SC'],
              ['São Paulo', 'SP'], ['Sergipe', 'SE'], ['Tocantins', 'TO']
            ]),
            {},
            {
              data: { cep_target: "state" },
              class: "#{input_classes} #{required_class}"
            } %>
      </div>

      <% if show_coordinates %>
        <!-- Coordenadas (campos ocultos) -->
        <div class="hidden">
          <%= af.hidden_field :latitude %>
          <%= af.hidden_field :longitude %>
        </div>
      <% end %>
    </div>

    <!-- Informações adicionais -->
    <div class="text-xs text-gray-500 dark:text-gray-400">
      Digite o CEP para preenchimento automático do endereço
    </div>
  </div>
<% end %>
