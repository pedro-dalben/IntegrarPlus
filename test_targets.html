<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste - Targets do Controller</title>
    <script src="https://unpkg.com/@hotwired/stimulus@3.2.2/dist/stimulus.umd.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .debug {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 4px;
        margin-top: 20px;
      }
      .debug h3 {
        margin-top: 0;
      }
      .error {
        color: red;
      }
      .success {
        color: green;
      }
    </style>
  </head>
  <body>
    <h1>Teste - Targets do Controller Dependent Specializations</h1>

    <!-- Estrutura similar ao formulário real -->
    <div
      data-controller="dependent-specializations"
      data-dependent-specializations-endpoint-value="/admin/specializations/by_speciality"
    >
      <h3>Permissões e Competências</h3>
      <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px">
        <div>
          <label for="specialities">Especialidades:</label>
          <select
            id="specialities"
            multiple
            data-dependent-specializations-target="specialitySelect"
          >
            <option value="1">Cardiologia</option>
            <option value="2">Neurologia</option>
            <option value="3">Ortopedia</option>
            <option value="4">Pediatria</option>
          </select>
        </div>

        <div>
          <label for="specializations">Especializações:</label>
          <select
            id="specializations"
            multiple
            data-dependent-specializations-target="specializationSelect"
          >
            <option value="">Selecione as especializações...</option>
          </select>
        </div>
      </div>
    </div>

    <div class="debug">
      <h3>Debug Console:</h3>
      <div id="debug-output"></div>
    </div>

    <script>
      // Controller de teste
      class DependentSpecializationsController {
        constructor() {
          this.specialitySelect = document.querySelector(
            '[data-dependent-specializations-target="specialitySelect"]'
          );
          this.specializationSelect = document.querySelector(
            '[data-dependent-specializations-target="specializationSelect"]'
          );
          this.debugOutput = document.getElementById('debug-output');

          this.init();
        }

        log(message, type = 'info') {
          const timestamp = new Date().toLocaleTimeString();
          const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
          this.debugOutput.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
          console.log(message);
        }

        init() {
          this.log('Controller inicializado');
          this.checkTargets();
          this.setupEventListeners();
        }

        checkTargets() {
          this.log('Verificando targets...');

          if (this.specialitySelect) {
            this.log('✅ Target specialitySelect encontrado', 'success');
          } else {
            this.log('❌ Target specialitySelect NÃO encontrado', 'error');
          }

          if (this.specializationSelect) {
            this.log('✅ Target specializationSelect encontrado', 'success');
          } else {
            this.log('❌ Target specializationSelect NÃO encontrado', 'error');
          }

          // Verificar se os elementos estão dentro do controller
          const controllerElement = document.querySelector(
            '[data-controller="dependent-specializations"]'
          );
          if (controllerElement) {
            this.log('✅ Elemento controller encontrado', 'success');

            const specialityInController = controllerElement.querySelector(
              '[data-dependent-specializations-target="specialitySelect"]'
            );
            const specializationInController = controllerElement.querySelector(
              '[data-dependent-specializations-target="specializationSelect"]'
            );

            if (specialityInController) {
              this.log('✅ specialitySelect está dentro do controller', 'success');
            } else {
              this.log('❌ specialitySelect NÃO está dentro do controller', 'error');
            }

            if (specializationInController) {
              this.log('✅ specializationSelect está dentro do controller', 'success');
            } else {
              this.log('❌ specializationSelect NÃO está dentro do controller', 'error');
            }
          } else {
            this.log('❌ Elemento controller NÃO encontrado', 'error');
          }
        }

        setupEventListeners() {
          if (this.specialitySelect) {
            this.specialitySelect.addEventListener('change', () => {
              this.log('Evento change disparado no select de especialidades');
              this.simulateSpecialityChange();
            });
          }
        }

        simulateSpecialityChange() {
          this.log('Simulando mudança de especialidades...');

          if (this.specializationSelect) {
            // Simular atualização das especializações
            this.specializationSelect.innerHTML =
              '<option value="">Selecione as especializações...</option>';

            const selectedOptions = Array.from(this.specialitySelect.selectedOptions);
            if (selectedOptions.length > 0) {
              this.log(
                `Especialidades selecionadas: ${selectedOptions.map(opt => opt.text).join(', ')}`
              );

              // Adicionar algumas especializações de exemplo
              const mockSpecializations = [
                { id: 1, name: 'Especialização 1', speciality: 'Especialidade 1' },
                { id: 2, name: 'Especialização 2', speciality: 'Especialidade 2' },
              ];

              mockSpecializations.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec.id;
                option.textContent = `${spec.name} (${spec.speciality})`;
                this.specializationSelect.appendChild(option);
              });

              this.log('Especializações atualizadas com sucesso', 'success');
            } else {
              this.log('Nenhuma especialidade selecionada');
            }
          }
        }
      }

      // Inicializar quando a página carregar
      document.addEventListener('DOMContentLoaded', () => {
        new DependentSpecializationsController();
      });
    </script>
  </body>
</html>
