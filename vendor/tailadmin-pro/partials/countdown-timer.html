<div class="mb-10" x-data="timer()" x-init="countdown()">
  <div
    class="mb-2 flex flex-wrap justify-center gap-1 text-title-md font-bold text-brand-500 dark:text-brand-400 xl:text-title-lg"
  >
    <!-- timer days -->
    <template x-for="(day, index) in daysArray" :key="index">
      <div x-show="day.visible" class="timer-box">
        <span x-text="day.value"></span>
      </div>
    </template>

    :

    <!-- timer hours -->
    <template x-for="(hour, index) in hoursArray" :key="index">
      <div x-show="hour.visible" class="timer-box">
        <span x-text="hour.value"></span>
      </div>
    </template>

    :

    <!-- timer minutes -->
    <template x-for="(minute, index) in minutesArray" :key="index">
      <div x-show="minute.visible" class="timer-box">
        <span x-text="minute.value"></span>
      </div>
    </template>

    :

    <!-- timer seconds -->
    <template x-for="(second, index) in secondsArray" :key="index">
      <div x-show="second.visible" class="timer-box">
        <span x-text="second.value"></span>
      </div>
    </template>
  </div>

  <div class="text-center text-base text-gray-500 dark:text-gray-400">
    <template x-for="(day, index) in daysArray" :key="index">
      <span x-show="day.visible" class="timer-box inline-block">
        <span x-text="day.value" class="inline-block"></span>
      </span>
    </template>
    days left
  </div>
</div>

<script>
  function timer() {
    return {
      daysArray: [],
      hoursArray: [],
      minutesArray: [],
      secondsArray: [],
      endTime: new Date("December 20, 2024 23:59:59 GMT+0530").getTime(),
      now: new Date().getTime(),
      timeLeft: 0,
      countdown: function () {
        let counter = setInterval(() => {
          this.now = new Date().getTime();
          this.timeLeft = (this.endTime - this.now) / 1000;

          this.updateTimeArrays();

          if (this.timeLeft <= 0) {
            clearInterval(counter);
            this.resetTimeArrays();
          }
        }, 1000);
      },
      format: function (value) {
        if (value < 10) {
          return "0" + Math.floor(value);
        } else return Math.floor(value);
      },
      updateTimeArrays: function () {
        this.daysArray = this.getTimeArray(
          this.timeLeft / (60 * 60 * 24),
          "days",
        );
        this.hoursArray = this.getTimeArray(
          (this.timeLeft / (60 * 60)) % 24,
          "hours",
        );
        this.minutesArray = this.getTimeArray(
          (this.timeLeft / 60) % 60,
          "minutes",
        );
        this.secondsArray = this.getTimeArray(this.timeLeft % 60, "seconds");
      },
      getMaxValueForUnit: function (unit) {
        switch (unit) {
          case "days":
            return 365;
          case "hours":
            return 24;
          case "minutes":
            return 60;
          case "seconds":
            return 60;
          default:
            return 1;
        }
      },
      getTimeArray: function (value, unit) {
        let stringValue = this.format(value).toString();
        let percentage = (value / this.getMaxValueForUnit(unit)) * 100;
        return stringValue.split("").map((digit) => ({
          value: digit,
          visible: true,
          remainingPercentage: percentage,
        }));
      },
      calcOverlayHeight: function () {
        let remainingDaysPercentage = this.daysArray[0].remainingPercentage;
        return `${remainingDaysPercentage}%`;
      },
      resetTimeArrays: function () {
        this.daysArray = [{ value: "0", visible: true }];
        this.hoursArray = [{ value: "0", visible: true }];
        this.minutesArray = [{ value: "0", visible: true }];
        this.secondsArray = [{ value: "0", visible: true }];
      },
    };
  }
</script>
